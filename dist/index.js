const u=t=>t.toLowerCase().replace(/^the\s+/i,"").replace(/\s*\([^)]*\)\s*/g,"").replace(/[^a-z0-9]/g,""),w=t=>{let e=t.artistName||"",s=t.trackName||"";if(!e&&s.includes(" - ")){const r=s.split(" - ");e=r[0].trim(),s=r.slice(1).join(" - ").trim()}return{artist:e,song:s}},m=t=>{const e=t.match(/<!-- Usage of azlyrics[\s\S]*?-->\s*([\s\S]*?)<\/div>/);return e?e[1].replace(/<br\s*\/?>/gi,`
`).replace(/<[^>]+>/g,"").trim():""},g=async(t,e)=>{const r=`https://www.azlyrics.com/${t.charAt(0)}/${t}.html`;try{const n=await application.networkRequest(r);if(!n.ok)return null;const l=await n.text(),a=new RegExp(`href="(/lyrics/${t}/[^"]+\\.html)"[^>]*>([^<]+)<`,"gi"),i=e.toLowerCase().replace(/[^a-z0-9]/g,"");let c;for(;(c=a.exec(l))!==null;){const o=c[1],p=c[2].toLowerCase().replace(/[^a-z0-9]/g,"");if(p.includes(i)||i.includes(p))return`https://www.azlyrics.com${o}`}}catch{return null}return null},h=async t=>{if(!await application.isNetworkRequestCorsDisabled())return await application.createNotification({type:"error",message:"InfoGata extension must be enabled to use this plugin."}),{lyrics:""};const{artist:e,song:s}=w(t),r=u(e),n=u(s);if(!r||!n)return{lyrics:""};const l=`https://www.azlyrics.com/lyrics/${r}/${n}.html`;try{let a=await application.networkRequest(l);if(!a.ok){const o=await g(r,n);if(!o)return{lyrics:""};a=await application.networkRequest(o)}const i=await a.text();return{lyrics:m(i)}}catch{return{lyrics:""}}};application.onGetLyrics=h;
